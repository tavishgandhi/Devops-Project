pipeline {
    agent any
    tools {
        maven "MAVEN"
        jdk "JAVA_HOME"
        
    }
    environment {                                      
        registry = "tavishgandhi/assignment_five"
        registryCredential = 'dockerhub'
    }
    
    stages {
        stage ('Clone Code'){
            steps{
                git branch: 'main', url: 'https://github.com/tavishgandhi/Devops-Project.git'
            }
            
        }
        stage('Build') {
            steps {
                bat 'mvn clean install'
            }
        }
        
        stage('Docker image creation') {
            steps {
                bat 'docker build -t tavishgandhi/assignment_five:devops-assignment-v1 .'
            }
        }
     
        stage('Publish image to Docker Hub') {
            steps {
                script{
                    withDockerRegistry(credentialsId: 'dockerhub') {
                    bat  'docker push tavishgandhi/assignment_five:devops-assignment-v1'
                    }
                }
            }
        }
              
        stage('Docker Based Deployment') {
            steps {
                bat "docker run --name devops-assignment-container -d -p 8095:8080 tavishgandhi/assignment_five:devops-assignment-v1"
            }
        }
    }
}
